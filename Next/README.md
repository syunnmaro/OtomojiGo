# Otomoji

<img alt="ShiftHubTop" src="https://github.com/kokimoriguchi/ShiftApp/assets/105916391/d9bcb669-82ea-4947-ac6b-7109b0ce2872">
<br>

## ⚪︎**サービス URL**

[Otomoji](https://web.realworld-demo.com)

<br>

## ⚪︎ 開発のきっかけ


中学校の頃の英語の先生がリスニングテストを自身の声を収録して作成されており、時間がかかっているという話を聞いた。教員の長時間労働が問題になっており自らの技術で解決できないかと考え、文字を入力するだけでテストが簡単に作れるOtomojiを作った。
<br>



## ⚪︎ 機能一覧

| トップ画面                                                                                                  | ダークモード画面                                                                                                 |
| ----------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------- |
| ![Top画面](https://github.com/kokimoriguchi/ShiftApp/assets/105916391/ca4fc924-765f-4532-9c37-a631f793e11d) | ![ダークモード](https://github.com/kokimoriguchi/ShiftApp/assets/105916391/4802aa58-a907-497d-89c3-67f6a68aed76) |
| ログイン画面、新規店舗登録、利用規約の画面に遷移できる様になっています。                                    | ハンバーガーメニュー内でダークモードの切り替えができ、全画面でダークモードが適用されるように実装しました。       |

| 新規店舗登録画面                                                                                                     | マネージャー作成画面                                                                                                     |
| -------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------ |
| ![新規店舗登録画面](https://github.com/kokimoriguchi/ShiftApp/assets/105916391/a9521855-ff5c-40a7-ae07-2f9d7512641c) | ![マネージャー作成画面](https://github.com/kokimoriguchi/ShiftApp/assets/105916391/38ec42bb-6c0a-42bc-ab1d-3477802c86ba) |
| 店名と店番を入力することで新規店舗登録可能にしています。                                                             | 店舗登録を行うとこの画面に遷移し 1 店舗に対して 1 人マネージャーを登録できる様にしています。                             |

| マネージャーログイン画面                                                                                                     | マネージャートップ画面                                                                                                      |
| ---------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------- |
| ![マネージャーログイン画面](https://github.com/kokimoriguchi/ShiftApp/assets/105916391/2bcfea84-93e1-4944-814b-0da71787b36f) | ![ マネージャートップ画面](https://github.com/kokimoriguchi/ShiftApp/assets/105916391/d173a9e0-aab5-40e6-9fe6-8155678242a3) |
| 登録した社員番号とパスワードを入力することでログイン可能にしています。                                                       | header 部分に店舗名:従業員登録名表示する様実装しています。この画面からマネージャー権限のある作業画面に遷移できます。        |

| 新規スタッフ登録画面                                                                                                     | スタッフ一覧画面                                                                                                                                                 |
| ------------------------------------------------------------------------------------------------------------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| ![新規スタッフ登録画面](https://github.com/kokimoriguchi/ShiftApp/assets/105916391/07edec35-639e-4061-8ad8-695b8193b9eb) | ![ スタッフ一覧画面](https://github.com/kokimoriguchi/ShiftApp/assets/105916391/7d064b68-0d47-4c3a-9279-cedf2d7daaee)                                            |
| マネージャートップ画面から新規スタッフ登録可能です。                                                                     | スタッフ一覧画面でログインしている店舗に所属しているスタッフの氏名・社員番号を確認できます。また、スタッフの削除・可能スキルのアタッチできる様に実装しています。 |

| スキル登録                                                                                                               | スキル一覧画面                                                                                                     |
| ------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------ |
| ![スキル登録](https://github.com/kokimoriguchi/ShiftApp/assets/105916391/24cf655d-1bee-4636-81bf-d1eb157da268)           | ![スキル一覧画面](https://github.com/kokimoriguchi/ShiftApp/assets/105916391/5e111484-ebc9-4bb1-a128-84bd377cc37f) |
| スキル登録ボタンクリックすることでモーダルが開き、ログインしている店舗に必要スキルを登録することがで切る様実装しました。 | 店舗に登録されているスキル一覧を確認できます。スタッフ一覧と同様チェックボックスで削除可能にしています。           |

| マネージャーシフト編集画面                                                                                                                                                                                                                         | 単日シフト確認画面                                                                                                                                                           |
| -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| ![シフト編集画面](https://github.com/kokimoriguchi/ShiftApp/assets/105916391/7d1ac287-cb2d-4a9a-b530-31878f214649)                                                                                                                                 | ![ 単日シフト確認画面](https://github.com/kokimoriguchi/ShiftApp/assets/105916391/5a4aea9e-012b-4162-994e-0b5d2075f545)                                                      |
| ⚪︎ 印がシフト提出されている日付になっておりクリックするとモーダルにて出勤時間の登録ができます。確定ボタン押すまでは何度でも編集可能です。登録されているスキルが満たされない日付は ✖️ マークで表示しておりモーダルにて不足スキルの確認ができます。 | シフト編集画面にて日付を押すことで単日表示のこの画面に遷移します。ユーザーからの要望により実現しました。出勤登録したスタッフの勤務時間を視覚的にみやすい様に実装しています。 |

| スタッフログイン画面                                                                                                     | スタッフトップ画面                                                                                                      |
| ------------------------------------------------------------------------------------------------------------------------ | ----------------------------------------------------------------------------------------------------------------------- |
| ![スタッフログイン画面](https://github.com/kokimoriguchi/ShiftApp/assets/105916391/27231597-361e-4f76-8b9d-02ed8f0e5cd9) | ![ スタッフトップ画面](https://github.com/kokimoriguchi/ShiftApp/assets/105916391/b41b6319-03ae-42ed-a688-f94c9ce4866f) |
| スタッフログイン画面でマネージャーログインと同様です。                                                                   | スタッフのトップ画面でシフトの提出・確定したシフトの確認ができるよう実装しています。                                    |

| スタッフシフト提出画面                                                                                                                                                             | スタッフシフト入力モーダル                                                                                              |
| ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------- |
| ![シフト提出画面](https://github.com/kokimoriguchi/ShiftApp/assets/105916391/7b2f9c41-f28d-4d0e-b5c1-63df9d0dceba)                                                                 | ![ シフト入力モーダル](https://github.com/kokimoriguchi/ShiftApp/assets/105916391/5710a9da-aa37-4b26-a6a2-9454ad6aae75) |
| 日付部分クリックすることで出勤・退勤時間の入力ができるモーダルが表示され登録ができます。一時保存と削除で入力内容の保持と削除・送信ボタンで入力内容の送信ができる様実装しています。 | シフト入力画面のモーダル表示です。                                                                                      |

| シフト確認モーダル                                                                                                     | 確定シフト確認画面                                                                                                                                                     |
| ---------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| ![シフト確認モーダル](https://github.com/kokimoriguchi/ShiftApp/assets/105916391/af28ba08-08b4-4531-b93a-83b2453c08e4) | ![ 確定シフト確認画面](https://github.com/kokimoriguchi/ShiftApp/assets/105916391/2017ea3a-d56b-4a8c-9278-696d996bccf6)                                                |
| シフト確認ボタンを押すことで現在確定されている年月を選択しシフトの確認画面に遷移します。マネージャー画面共通です。     | 確定したシフトを確認できます。カレンダー部分は画面内スクロールで確認でき、日付をクリックすると単日表示ができます。不足スキルも確認できます。マネージャー画面共通です。 |

<br>

<br>

## ⚪︎ 主な使用技術

| Category       | Technology Stack                 |
|----------------|----------------------------------|
| Frontend       | React, Tailwind, Radix           |
| Backend        | Nextjs                           |
| Infrastructure | Vercel                           |
| Database       | PlanetScale                      |
| ORM            | Prisma                           |
| library        | superstruct, fontawesome,Auth.js |

<br>

## ⚪︎ 技術採用の意図

<details>
<summary>React</summary>

- Djangoでは静的なページが要求された場合Nginxて返すと言ったアプローチだった。ほとんどのデータがAPIでやって来て、動的にあらゆるものが構築され、htmlが中身のないulタグが陳列されるようになるとは思っていなかった。そのためキャッシュがAPI単位で行われるようになり、非常に管理しやすくなった。
- ただ、テンプレートエンジンとJSXは似ていたので比較的飲み込みやすかった。また、webpackによって部品化することができるようになったのは大きい。
- DOMの更新を最小限にするために、差分を求めてその部分だけをレンダリングするという考え。そのおかげで人間がDOM操作をする必要が無い。
</details>

<details>
<summary>auth.js</summary>

- Django,OracleDBで開発していた際はsessionで認証を行っていたが、DBにplanetscaleを採用したことで検索回数に応じたコストの増加を懸念してjwtを採用することにした。
- jwtを使うべきではないという声が多くあったのでかなり調べた。セキュリティーの問題(alg noneなど)が指摘されていたので、自前で実装するのではなく、ライブラリーに頼った
</details>

<details>
<summary>Next.js</summary>

- 元々は、React単体でGoでAPIサーバーを立ててSPAにしていた。FireStoreの価格が高く、アクセスする回数を減らすためにGoでキャッシュサーバー立ていた。しかし、Cloudflareを知って、あまりの安さにWorkerにAPIサーバーを立てようと考える。バックエンドをHonoに変更。Nextjsを知り、ちょうどその時期にAPI Handlersが発表され、バックエンドが不要に。加えて、キャッシュをやってくれるのがいい。ServerActionが追加され、APIサーバーを叩く必要もなくなりそうで楽しみ。
- SPAでは、セキュリティ関係が大変だった。
- </details>

<details>

<summary>vercel</summary>

- Hobbyプランが無料なので採用。収益化する際は、CloudflarePagesに移行したい。
</details>

<details>
<summary>その他</summary>

- DBはPlanetScaleを使用。Firestoreを一時期使っていたが、無料枠が少なかったので移行。

- ORMはPrismaを使用。API通信において型の管理が非常に大変だったが、prismaによってかなり楽になった。Zod,superstructと併せて使うことでフロント、バックエンドでも型安全性を担保
</details>



<br>

## ⚪︎ 工夫した点
<details>
<summary>DB設計について</summary>

- author_idをあえて正規化しなかった。
例えば、blocksを取得したい場合、Workにしかauthor_idを記載していないと、ユーザーがblocksの属すPartを取得し、Partの属すWorkを取得してWorkのAuthorを確認して認可するという手順を踏まなければならず、処理速度の低下につながる。
- また、author_idは一度設定したら変わることがないのでこのような実装でも問題ないと判断した。
</details>


## ⚪︎ 今後の課題及び追加予定機能

<details>
<summary>キャッシュ関係</summary>

- 現状fetchAPIのキャッシュがHeaderを設定していることによってうまくできていない。
- 合成された音声をキャッシュしたい。nodejsでの音声の扱いが難しくて断念しているが、いずれは実装したい。pydub...
</details>
<details>
<summary>Block</summary>

- Blockを移動することができる機能とコピーペーストを実装したい。
</details>

<details>
<summary>コードをきれいに</summary>

- 特にHTMLのコードが汚いので、きれいにしたい。
</details>

<details>
<summary>ディレクトリー構造</summary>

- 特にHTMLのコードが汚いので、きれいにしたい。
</details>

